@using Omni.Agence.DAL;
@model Omni.Agence.DAL.Operation
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Nouveau Paiement";
    ViewBag.PD = "start active open";
    ViewBag.PLS = "active";
    ViewBag.PDCS = "selected";
}
@section Styles {
    @Styles.Render("~/Content/DataTableM")


    @Styles.Render("~/bundles/DatePicker")
}
<div class="modal fade" id="portlet-config" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">Modal title</h4>
            </div>
            <div class="modal-body">
                Widget settings form goes here
            </div>
            <div class="modal-footer">
                <button type="button" class="btn blue">Save changes</button>
                <button type="button" class="btn default" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<h3 class="page-title">
    Paiement <small>Loyer</small>
</h3>
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <i class="fa fa-home"></i>
            <a href="@Url.Action("Index","Home")">Accueil</a>
            <i class="fa fa-angle-right"></i>
        </li>
    </ul>

</div>
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN PORTLET-->
        <div class="portlet box grey-cascade">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-gift"></i>Paiement Loyer
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse">
                    </a>

                </div>
            </div>
            <div class="portlet-body form">
                <!-- BEGIN FORM-->
                @using (Html.BeginForm())
                {
                    @*@Html.AntiForgeryToken()*@

                    <div class="form-horizontal">

                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })


                        <div class="form-body">
                            <div class="form-group">
                                <label class="control-label col-md-3">Code Locataire</label>
                                <div class="col-md-3">
                                    <input type="text" name="CodePers" id="CodePers" value="@ViewBag.RefCodeLoc" readonly="readonly" />
                                    @*@Html.EditorFor(model => model.CodePers)*@
                                    <span class="help-block">

                                    </span>
                                    <a class="btn default" data-toggle="modal" href="#form_modal2">
                                        Charger locataire
                                    </a>
                                </div>
                            </div>

                            <h3 class="form-section">Contrats en cours</h3>
                            <div class="table-toolbar">
                                <div class="row">
                                    <div class="col-md-6">
                                        @using System.Linq;
                                        @using System.Data.Entity;


                                        @{
                    Omni.Agence.DAL.AgenceEntities db = new Omni.Agence.DAL.AgenceEntities();
                    int? cp = ViewBag.codePersLocataire;
                    var contratLocations = db.ContratLocations.Include(c => c.Local).Include(c => c.Personne).Where(p => p.CodePers == 0);
                    if (ViewBag.codePersLocataire != null)
                    {
                        contratLocations = db.ContratLocations.Include(c => c.Local).Include(c => c.Personne).Where(p => p.CodePers == cp && p.isClosed == 1);
                    }

                    List<Omni.Agence.DAL.ContratLocation> contrats = contratLocations.ToList();

                                        }
                                        <div class="btn-group">

                                            @*@Html.ActionLink("Afficher", "Create")*@

                                        </div>
                                    </div>

                                </div>
                            </div>

                            <table class="table table-striped table-bordered table-hover" id="sample_2">
                                <thead>
                                    <tr>
                                        <th>Code</th>
                                        <th>
                                            Usage
                                        </th>
                                        <th>
                                            Local
                                        </th>

                                        <th>
                                            Date de jouissance
                                        </th>
                                        <th>
                                            Date fin
                                        </th>

                                        <th>
                                            Loyer de base
                                        </th>
                                        <th>
                                            Loyer net
                                        </th>
                                        @*<th>
                                                Date Aug.
                                            </th>
                                            <th>
                                                Aug. %
                                            </th>*@

                                        <th></th>
                                    </tr>

                                </thead>
                                <tbody>

                                    @foreach (var item in contrats)
                                    {
                                        <tr>
                                            <td>
                                                <a href="@Url.Action("SelectContrat", new { id = item.CodeContrat })">
                                                    @Html.DisplayFor(modelItem => item.CodeContrat)
                                                </a>
                                            </td>
                                            <td>
                                                @{

                                        if (item.Usage == 0)
                                        {
                                            ViewBag.Usage = "Habitation";
                                        }
                                        else if (item.Usage == 1)
                                        {
                                            ViewBag.Usage = "Commercial";
                                        }
                                        else
                                        {
                                            ViewBag.Usage = "";
                                        }
                                                }
                                                @ViewBag.Usage
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Local.TitreLocal)
                                            </td>

                                            <td>
                                                @item.DateJuissance.Value.Date.ToString("dd/MM/yyyy")
                                                @*@Html.DisplayFor(modelItem => item.DateJuissance.Value.Day)/@Html.DisplayFor(modelItem => item.DateJuissance.Value.Month)/@Html.DisplayFor(modelItem => item.DateJuissance.Value.Year)*@
                                            </td>

                                            <td>

                                                @if (item.DateFinContrat.HasValue)
                                                {
                                                    item.DateFinContrat.Value.Date.ToString("dd/MM/yyyy");
                                                }
                                                @*@item.DateFinContrat.Value.Date.ToString("dd/MM/yyyy")*@
                                                    @*@Html.DisplayFor(modelItem => item.DateFinContrat.Value.Day)/@Html.DisplayFor(modelItem => item.DateFinContrat.Value.Month)/@Html.DisplayFor(modelItem => item.DateFinContrat.Value.Year)*@
                                                </td>

                                                <td>
                                                    @Html.DisplayFor(modelItem => item.LoyerDebase)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.LoyerNet)
                                                </td>
                                                @*<td>
                                                        @if ((item.Augementations.Count() != 0))
                                                        {

                                                            @Html.DisplayFor(modelItem => item.Augementations.Where(d => d.dateAug > DateTime.Now).OrderBy(d => d.dateAug).First().dateAug.Value)

                                                        }
                                                    </td>
                                                    <td>
                                                        @if ((item.Augementations.Count() != 0))
                                                        {
                                                            @Html.DisplayFor(modelItem => item.Augementations.Where(d => d.dateAug > DateTime.Now).OrderBy(d => d.dateAug).First().pcAug)
                                                        }
                                                    </td>*@


                                                <td>
                                                    @*<a href="@Url.Action("DetailsContrat", new { id = item.CodeContrat })" class="btn default btn-xs green-haze tooltips" data-placement="bottom" data-original-title="Détails Contrat">
                                                            <i class="fa fa-pencil"></i>
                                                        </a>*@
                                                    <a href="#@item.CodeContrat" class="btn default btn-xs green-haze tooltips" data-toggle="modal" data-placement="left" data-original-title="Détails Contrat ">
                                                        <i class="fa fa-edit"></i>
                                                    </a>
                                                    <div id="@item.CodeContrat" class="modal fade" tabindex="-1" aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                                                    <h4 class="modal-title">Informations</h4>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Locataire:</label>
                                                                                <div class="col-md-5">
                                                                                    <p class="form-control-static">
                                                                                        @if (string.IsNullOrEmpty(item.Personne.rc))
                                                                                        {
                                                                                            @Html.DisplayFor(modelItem => item.Personne.nom) @Html.DisplayFor(modelItem => item.Personne.prenom)

                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            @Html.DisplayFor(modelItem => item.Personne.employeur)

                                                                                        }
                                                                                    </p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <div class="radio-list">
                                                                                    <p class="form-control-static">
                                                                                        @{
                                                                                        string ch1 = null;
                                                                                        string ch2 = null;
                                                                                        if (item.Usage == 0)
                                                                                        {
                                                                                            ch1 = "checked";
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            ch2 = "checked";
                                                                                        }

                                                                                        }

                                                                                        <label class="radio-inline">
                                                                                            <input type="radio" name="usage" disabled="disabled" checked="@ch1" />Habitation
                                                                                        </label>
                                                                                        <label class="radio-inline">
                                                                                            <input type="radio" name="usage" disabled="disabled" checked="@ch2" />Commercial
                                                                                        </label>
                                                                                    </p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <!--/row-->
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Titre local</label>
                                                                                <div class="col-md-5">
                                                                                    <p class="form-control-static">@Html.DisplayFor(modelItem => item.Local.TitreLocal)</p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!--/span-->
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Propriétaire</label>
                                                                                <div class="col-md-5">

                                                                                    <p class="form-control-static">
                                                                                        @if (string.IsNullOrEmpty(item.Local.Personne.rc))
                                                                                        {
                                                                                            <label>
                                                                                                @Html.DisplayFor(modelItem => item.Local.Personne.nom) @Html.DisplayFor(modelItem => item.Local.Personne.prenom)
                                                                                            </label>


                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            @Html.DisplayFor(modelItem => item.Local.Personne.employeur)

                                                                                        }

                                                                                    </p>
                                                                                </div>

                                                                            </div>
                                                                        </div>
                                                                        <!--/span-->
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Début</label>
                                                                                <div class="col-md-5">
                                                                                    <p class="form-control-static">
                                                                                        @Html.DisplayFor(modelItem => item.DateJuissance.Value.Day)/@Html.DisplayFor(modelItem => item.DateJuissance.Value.Month)/@Html.DisplayFor(modelItem => item.DateJuissance.Value.Year)
                                                                                    </p>
                                                                                </div>


                                                                            </div>
                                                                        </div>
                                                                        <!--/span-->
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Fin</label>
                                                                                <div class="col-md-5">
                                                                                    <p class="form-control-static">
                                                                                        @if (item.DateFinContrat.HasValue)
                                                                                        {
                                                                                            Html.DisplayFor(modelItem => item.DateFinContrat.Value);
                                                                                        }


                                                                                        @*@Html.DisplayFor(modelItem => item.DateFinContrat.Value.Day)/@Html.DisplayFor(modelItem => item.DateFinContrat.Value.Month)/@Html.DisplayFor(modelItem => item.DateFinContrat.Value.Year)*@
                                                                                    </p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!--/span-->
                                                                    </div>
                                                                    <!--/row-->
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Loyer de base</label>
                                                                                <div class="col-md-5"><p class="form-control-static">@Html.DisplayFor(modelItem => item.LoyerDebase)</p></div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Charge</label>
                                                                                <div class="col-md-5"><p class="form-control-static">@Html.DisplayFor(modelItem => item.Charge)%</p></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">

                                                                        <!--/span-->


                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Taxe</label>
                                                                                <div class="col-md-5"><p class="form-control-static">@Html.DisplayFor(modelItem => item.TaxeDedilite)%</p></div>
                                                                            </div>
                                                                        </div>
                                                                        <!--/span-->
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Garage</label>
                                                                                <div class="col-md-5"><p class="form-control-static">@Html.DisplayFor(modelItem => item.Garage)</p></div>

                                                                            </div>
                                                                        </div>
                                                                        <!--/span-->
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Loyer net</label>
                                                                                <div class="col-md-5"><p class="form-control-static">@Html.DisplayFor(modelItem => item.LoyerNet)</p></div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <div class="radio-list">
                                                                                    <p class="form-control-static">
                                                                                        @{
                                                                                        string ch11 = null;
                                                                                        string ch12 = null;
                                                                                        if (item.FrequencePaiement == 0)
                                                                                        {
                                                                                            ch11 = "checked";
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            ch12 = "checked";
                                                                                        }

                                                                                        }

                                                                                        <label class="radio-inline">
                                                                                            <input type="radio" name="FrequencePaiement" disabled="disabled" checked="@ch11" />Mensuel
                                                                                        </label>
                                                                                        <label class="radio-inline">
                                                                                            <input type="radio" name="FrequencePaiement" disabled="disabled" checked="@ch12" />Trimestriel
                                                                                        </label>
                                                                                    </p>
                                                                                </div>

                                                                            </div>
                                                                        </div>
                                                                        <!--/span-->
                                                                        <!--/span-->
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Adultes</label>
                                                                                <div class="col-md-5"><p class="form-control-static">@Html.DisplayFor(modelItem => item.adults)</p></div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Enfants</label>
                                                                                <div class="col-md-5"><p class="form-control-static">@Html.DisplayFor(modelItem => item.enfants)</p></div>

                                                                            </div>
                                                                        </div>
                                                                        <!--/span-->
                                                                        <!--/span-->
                                                                    </div>
                                                                    <div class="row">

                                                                        @* Commentée pour debug !!!!
                                                                                <div class="col-md-6">
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-5">Animaux</label>
                                                                                    <div class="col-md-5"><p class="form-control-static">@Html.CheckBoxFor(modelItem => item.animaux.Value, new { @disabled = "disabled" })</p></div>
                                                                                </div>
                                                                            </div>*@

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-5">Commentaire</label>
                                                                                <div class="col-md-5"><p class="form-control-static">@Html.DisplayFor(modelItem => item.commentaire)</p></div>

                                                                            </div>
                                                                        </div>
                                                                        <!--/span-->
                                                                    </div>
                                                                    <div class="row">

                                                                        <!--/span-->
                                                                        <!--/span-->
                                                                    </div>

                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" data-dismiss="modal" class="btn default">Close</button>
                                                                    @*@if (item.ContratLocations.Count() == 0)
                                                                            {
                                                                        <a href="@Url.Action("DeleteConfirmedAppart", new { id = Model.CodePers })" class="btn red">
                                                                            Valider
                                                                        </a>
                                                                            }*@

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    @*@Html.ActionLink("Paiement", "PaiementLoc", new { id = item.CodeContrat })*@

                                                </td>
                                            </tr>
                                    }
                                </tbody>
                            </table>


                            <div class="portlet-body form">
                                <!-- BEGIN FORM-->
                                @using (Html.BeginForm())
                                {
                                    @Html.AntiForgeryToken()

                                    <div class="form-horizontal">

                                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                        @{
                                    int? cc = ViewBag.CodeContrat;
                                    ContratLocation contrat;
                                    if (cc != null)
                                    {
                                        contrat = db.ContratLocations.Where(c => c.CodeContrat == cc).First();


                                        <h3 class="form-section">Paiements</h3>
                                            <div class="portlet-body">
                                                <div class="table-toolbar">
                                                    <div class="row">
                                                        <div class="col-md-6">

                                                            <div class="btn-group">

                                                                @*<a href="@Url.Action("CreatePL", new { id = ViewBag.CodeContrat })" class="btn blue-chambray  tooltips" data-placement="bottom" data-original-title="Paiement">
                                                                        <i class="fa fa-plus"></i>
                                                                    </a>*@

                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                                <table class="table table-striped table-bordered table-hover" id="sample_3">
                                                    <thead>
                                                        <tr>
                                                            <th>
                                                                Moy. Paiement
                                                            </th>
                                                            <th>
                                                                Montant
                                                            </th>
                                                            <th>
                                                                Réference
                                                            </th>
                                                            <th>
                                                                Date début
                                                            </th>

                                                            <th>
                                                                Date fin
                                                            </th>
                                                            <th>
                                                                @*Nbr Quittance imprimée*@
                                                                Date facturation
                                                            </th>



                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @{


                                        List<PaiementLoyer> ListP = db.PaiementLoyers.Where(p => p.CodeContrat == cc.Value).ToList();
                                        //DateTime dateMax = ListP.OrderBy(d => d.DteFin).Last().DteFin.Value;

                                                        }
                                                        @foreach (var item in ListP)
                                                        {
                                                            <tr>
                                                                <td>
                                                                    @Html.DisplayFor(modelItem => item.MoyenPaiement)
                                                                </td>
                                                                <td>
                                                                    @Html.DisplayFor(modelItem => item.Operation.montant)
                                                                </td>
                                                                <td>
                                                                    @Html.DisplayFor(modelItem => item.Reference)
                                                                </td>

                                                                <td>
                                                                    @item.DteDebut.Value.Date.ToString("dd/MM/yyyy")
                                                                    @*@Html.DisplayFor(modelItem => item.DteDebut.Value.Day)/@Html.DisplayFor(modelItem => item.DteDebut.Value.Month)/@Html.DisplayFor(modelItem => item.DteDebut.Value.Year)*@
                                                                </td>

                                                                <td>
                                                                    @item.DteFin.Value.Date.ToString("dd/MM/yyyy")
                                                                    @*@Html.DisplayFor(modelItem => item.DteFin.Value.Day)/@Html.DisplayFor(modelItem => item.DteFin.Value.Month)/@Html.DisplayFor(modelItem => item.DteFin.Value.Year)*@
                                                                </td>
                                                                <td>
                                                                    @if (item.DateFact != null)
                                                                    {
                                                                        @item.DateFact.Value.Date.ToString("dd/MM/yyyy")
                                                                    }
                                                                    @*@Html.DisplayFor(modelItem => item.NbrQuittanceImprime)*@
                                                                </td>
                                                                <td>

                                                                    <a href="@Url.Action("print", new { id = item.Operation.codeOp }) " class="btn default btn-xs blue-chambray tooltips" data-placement="bottom" data-original-title="Details">
                                                                        <i class="fa fa-file-pdf-o"></i>
                                                                    </a>
                                                                    <a href="@Url.Action("DeletePLoc", new { id = item.Operation.codeOp })" class="btn default btn-xs black tooltips" data-placement="bottom" data-original-title="Supprimer Paiement">
                                                                        <i class="fa fa-trash-o"></i>
                                                                    </a>
                                                                    @*@Html.ActionLink("Details", "print", new { id = item.Operation.codeOp }) |*@
                                                                    @*@Html.ActionLink("Supprimer", "DeletePLoc", new { id = item.Operation.codeOp })*@
                                                                </td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>




                                            <h3 class="form-section">Nouveau</h3>

                                            <div class="form-body">

                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-5">Taxe:</label>
                                                        <div class="col-md-5">
                                                            <p class="form-control-static">
                                                                @contrat.TaxeDedilite %
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-5">Charge:</label>
                                                        <div class="col-md-5">
                                                            <p class="form-control-static">
                                                                @contrat.Charge %
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-5">Date Aug:</label>
                                                        <div class="col-md-5">
                                                            <p class="form-control-static">
                                                                @*@ListP.OrderBy(dd => dd.DteFin).Last().DteFin.Value
                                                                    @ListP.First().ContratLocation.Augementations.Where(c => c.dateAug < ListP.OrderBy(dd => dd.DteFin).Last().DteFin.Value).OrderBy(d => d.dateAug).Last().dateAug.Value*@





                                                                @{
                                        if (contrat.Augementations.Count() > 0)
                                        {

                                            if (contrat.Augementations.Where(d => d.dateAug.Value < DateTime.Now).Count() > 0)
                                            {
                                                @contrat.Augementations.Where(d => d.dateAug.Value < DateTime.Now).OrderBy(d => d.dateAug).Last().dateAug.Value.Date.ToString("dd/MM/yyyy");
                                            }
                                        }}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-5">Augmentation:</label>
                                                        <div class="col-md-5">
                                                            <p class="form-control-static">
                                                                @{
                                        if (contrat.Augementations.Count() > 0)
                                        {
                                            if (contrat.Augementations.Where(d => d.dateAug.Value < DateTime.Now).Count() > 0)
                                            {
                                                @contrat.Augementations.Where(d => d.dateAug.Value < DateTime.Now).OrderBy(d => d.dateAug).Last().pcAug ;
                                            }
                                        }}
                                                                %
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-5">Garage:</label>
                                                        <div class="col-md-5">
                                                            <p class="form-control-static">
                                                                @contrat.Garage

                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-5">
                                                                @{
                                        int fp = contrat.FrequencePaiement.Value;
                                        String sfp = "";
                                        if (fp == 0)
                                        {
                                            sfp = "mensuel";
                                        }
                                        else if (fp == 1)
                                        {
                                            sfp = "trimestriel";
                                        }
                                                                }
                                                                Loyer de base mensuel :
                                                            </label>
                                                            <div class="col-md-5">
                                                                <p class="form-control-static">
                                                                    @contrat.LoyerDebase
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-5">Date fin contrat :</label>
                                                            <div class="col-md-5">
                                                                <p class="form-control-static">

                                                                    @if (contrat.DateFinContrat.HasValue)
                                                                    {
                                                                        contrat.DateFinContrat.Value.Date.ToString("dd/MM/yyyy");
                                                                    }

                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">


                                                </div>

                                                <h3 class="form-section"></h3>
                                                @{
                                                                    if (contrat.PaiementLoyers.Count() > 0)
                                                                    {
                                                                        ViewBag.dateDP = contrat.PaiementLoyers.OrderBy(d => d.DteFin).Last().DteFin.Value.AddDays(1);
                                                                        if (contrat.FrequencePaiement == 0)
                                                                        {
                                                                            ViewBag.dateFP = contrat.PaiementLoyers.OrderBy(d => d.DteFin).Last().DteFin.Value.AddMonths(1);
                                                                        }
                                                                        else if (contrat.FrequencePaiement == 1)
                                                                        {
                                                                            ViewBag.dateFP = contrat.PaiementLoyers.OrderBy(d => d.DteFin).Last().DteFin.Value.AddMonths(3);
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        ViewBag.dateDP = contrat.DateJuissance.Value;

                                                                        if (contrat.FrequencePaiement == 0)
                                                                        {
                                                                            ViewBag.dateFP = contrat.DateJuissance.Value.AddMonths(1).AddDays(-1);
                                                                        }
                                                                        else if (contrat.FrequencePaiement == 1)
                                                                        {
                                                                            ViewBag.dateFP = contrat.DateJuissance.Value.AddMonths(3).AddDays(-1);
                                                                        }
                                                                    }

                                                                    int aug;


                                                                    if (contrat.Augementations.Count() > 0)
                                                                    {
                                                                        if (contrat.Augementations.Where(d => d.dateAug.Value < DateTime.Now).Count() > 0)
                                                                        {
                                                                            aug = contrat.Augementations.Where(d => d.dateAug.Value < DateTime.Now).OrderBy(d => d.dateAug).Last().pcAug.Value;
                                                                        }
                                                                        else
                                                                        {
                                                                            aug = 0;
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        aug = 0;
                                                                    }
                                                                    int taxe = contrat.TaxeDedilite.Value;

                                                                    int charge = contrat.Charge.Value;
                                                                    int garage = contrat.Garage.Value;
                                                                    double loyerBase = contrat.LoyerDebase.Value;
                                                                    double loyerNet = garage + ((100 + taxe + charge + aug) * loyerBase) / 100;
                                                                    if (contrat.FrequencePaiement == 0)
                                                                    {
                                                                        ViewBag.loyerNet = loyerNet;
                                                                    }
                                                                    else if (contrat.FrequencePaiement == 1)
                                                                    {
                                                                        ViewBag.loyerNet = loyerNet * 3;
                                                                    }

                                                }
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Durée :</label>
                                                    <div class="col-md-4">
                                                        <div class="input-group input-large date-picker input-daterange" data-date="10/11/2012" data-date-format="dd/mm/yyyy">

                                                            @*@Html.EditorFor(model => model.PaiementLoyer.DteDebut, new { htmlAttributes = new { @class = "form-control", @name = "from" } })*@
                                                            <input type="text" name="PaiementLoyer.DteDebut" id="PaiementLoyer.DteDebut" class="form-control" value="@ViewBag.dateDP.ToString("dd/MM/yyyy")" readonly="readonly" /><span class="input-group-addon">
                                                                Jusqu'a
                                                            </span>
                                                            @*@Html.EditorFor(model => model.PaiementLoyer.DteFin, new { htmlAttributes = new { @class = "form-control"} })*@
                                                            <input type="text" name="PaiementLoyer.DteFin" id="PaiementLoyer.DteFin" class="form-control" value="@ViewBag.dateFP.ToString("dd/MM/yyyy")" readonly="readonly" />
                                                        </div>
                                                        <!-- /input-group -->
                                                        <span class="help-block">
                                                            @Html.ValidationMessageFor(model => model.PaiementLoyer.DteDebut, "", new { @class = "text-danger" })
                                                        </span>
                                                        <span class="help-block">
                                                            @Html.ValidationMessageFor(model => model.PaiementLoyer.DteFin, "", new { @class = "text-danger" })
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Montant</label>
                                                    <div class="col-md-3">
                                                        <input type="text" name="montant" id="montant" class="form-control" value="@ViewBag.loyerNet" readonly="readonly" />
                                                        @*@Html.EditorFor(model => model.montant, new { @class = "form-control", value = 232 })*@<!-- /input-group -->
                                                        <span class="help-block">
                                                            @Html.ValidationMessageFor(model => model.montant, "", new { @class = "text-danger" })
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Mode de paiement:</label>
                                                    <div class="col-md-3">
                                                        @Html.DropDownListFor(
                                                   model => model.PaiementLoyer.MoyenPaiement,
                                                   new SelectList(
                                                          new List<Object>{
                                                               new { value = "Espèce" , text = "Espèce"  },
                                                               new { value = "Chèque" , text = "Chèque" },
                                                               new { value = "Prélèvement Bancaire" , text = "Prélèvement Bancaire"},
                                                               new { value = "Virement" , text = "Virement"}
                                                            },
                                                          "value",
                                                            "text"

                                                    ), new { @class = "form-control" }
                                                            )
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Réference:</label>
                                                    <div class="col-md-3">
                                                        @*<input type="number" name="PaiementLoyer.Reference" id="Reference" class="form-control"/>*@
                                                        @Html.EditorFor(model => model.PaiementLoyer.Reference, new { htmlAttributes = new { @class = "form-control" } })
                                                        <span class="help-block">
                                                            @Html.ValidationMessageFor(model => model.PaiementLoyer.Reference, "", new { @class = "text-danger" })
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">Commentaire:</label>
                                                    <div class="col-md-3">
                                                        @Html.TextAreaFor(model => model.Commentaire, new { @class = "form-control", @cols = 290, @rows = 4 })
                                                        <!-- /input-group -->
                                                        <span class="help-block">
                                                            @Html.ValidationMessageFor(model => model.Commentaire, "", new { @class = "text-danger" })
                                                        </span>
                                                    </div>
                                                </div>

                                                <div class="form-group last">
                                                    <div class="col-md-offset-2 col-md-10">
                                                        @*<input type="submit" value="Valider" class="btn blue-chambray" />*@
                                                        <a class="btn blue-chambray" data-toggle="modal" href="#basic">
                                                            Valider
                                                        </a>
                                                        <input type="reset" value="Annuler" class="btn btn red" />
                                                        <a href="@Url.Action("Create")" class="btn green">
                                                            Retour
                                                        </a>
                                                    </div>
                                                </div>
                                                <div class="modal fade" id="basic" tabindex="-1" role="basic" aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                                                <h4 class="modal-title">Confirmation</h4>
                                                            </div>
                                                            <div class="modal-body">

                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn default" data-dismiss="modal">Fermer</button>
                                                                <input type="submit" class="btn blue-chambray" value="Valider" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                    }

                                        }
                                    </div>
                                }





                                <!-- END FORM-->
                            </div>


                        </div>


                    </div>}

                <div id="form_modal2" class="modal fade" role="dialog" aria-hidden="true">
                    <div class="modal-dialog">
                        @*<div class="modal-content">*@

                        <div class="modal-body" style="width:670px">

                            @Html.Partial("ListLocataire")

                        </div>
                    </div>
                </div>


            </div>
        </div>
        <!-- END PORTLET-->
    </div>
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/Scripts/DatePicker")
    @Scripts.Render("~/bundles/DataTableM")
    <script>
        jQuery(document).ready(function () {
            TableManaged.init();
        });
    </script>

    <script type="text/javascript">
        // When the document is ready
        $(document).ready(function () {

            $('.input-daterange').datepicker({
                todayBtn: "linked"
            });

        });
    </script>
}
